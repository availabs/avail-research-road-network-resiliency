### Final Report: TRANSCOM Dataset Integrated with OSMnx Road Network for Flooding Events

NOTE: The following was generated by xAI's Grok 3 generative AI, then revised by Google's Gemini (2.5 Pro).

#### 1. Introduction

The Transportation Operations Coordinating Committee (TRANSCOM) dataset is a vital tool for real-time traffic management and transportation research, delivering detailed data on traffic incidents, construction activities, and other events affecting road networks across the New York, New Jersey, and Connecticut tri-state region. Managed by TRANSCOM, a coalition of transportation and emergency management agencies, the dataset supports operational coordination, public safety, and research initiatives. It is accessible to a wide range of stakeholders—including transportation agencies, commercial vendors, and researchers—via the T-REX Connect API and the public portal at [data.xcmdata.org](https://data.xcmdata.org/) (TRANSCOM, n.d.).

This report examines a specialized subset of the TRANSCOM dataset, which integrates flooding-related event data with the OpenStreetMap (OSM) road network using OSMnx, a Python library for geospatial network analysis (Boeing, 2017). By merging TRANSCOM’s real-time flooding event records with OSMnx’s detailed road network geometries, this dataset facilitates spatial and temporal analysis of flooding impacts on transportation infrastructure. Such integration is invaluable for transportation planners, emergency responders, and researchers investigating flood resilience, network accessibility, and traffic management strategies.

#### 2. Dataset Overview

The TRANSCOM dataset encompasses two primary data categories:

- **Real-Time Event Data**: This includes records of traffic incidents (e.g., accidents, flooding), construction activities, and other disruptions, with over 100 event types classified by attributes such as impact severity and visibility (Infosenseglobal Solutions, 2021; NYSDOT, 2022).
- **Link (Travel Time) Data**: This provides travel time metrics for specific road segments, enabling analysis of traffic flow and congestion (TRANSCOM, n.d.).

**Data Sources**:

- **New York State Department of Transportation (NYSDOT) Systems**: These include Road Weather Information Systems (RWIS), Traffic Volumes, Snow Plow AVLs, HELP Trucks, Overheight Detection Systems, Highway Rail Systems, and Work Zone Speed Enforcement Systems (NYSDOT, n.d.).
- **Partner Agencies**: Contributions from local and regional agencies, including camera feeds and traffic sensor data, enhance the dataset’s scope (NYSERDA, 2021).

**Applications**:

- **Information Dissemination**: Real-time updates support agency coordination and public awareness (FHWA, 2006).
- **Application Development**: The dataset underpins traffic navigation tools and mobile applications (TRANSCOM, n.d.).
- **Research**: It enables studies on traffic patterns, incident impacts, and infrastructure resilience (Infosenseglobal Solutions, 2021).

The dataset’s availability through the T-REX Connect API ensures standardized, secure access for real-time and historical analysis (Infosenseglobal Solutions, 2021).

### 3. Methodology: Integrating TRANSCOM Events with OSMnx Road Network

The integration of TRANSCOM event data with the OpenStreetMap (OSM) road network, facilitated by OSMnx, provides a robust analytical framework for assessing the impact of various incidents, particularly flooding, on transportation infrastructure. This methodology focuses on a precise geospatial and temporal linkage between reported events and specific road segments, enabling detailed vulnerability and impact analyses. The process leverages a dynamic, region-specific Lambert Azimuthal Equal-Area (LAEA) projection to ensure metric accuracy in all spatial operations, and employs a Prefect-based workflow for orchestration and reproducibility.

**3.1 Data Ingestion and Preparation**

The foundational step involves preparing both the road network and event datasets:

1. **OSM Road Network Enrichment:** OpenStreetMap data for the specified region is ingested from an input PBF (Protocolbuffer Binary Format) file. Using the OSMnx library, this raw data is processed to construct a detailed, routable street network. This includes deriving essential road segment attributes and creating a buffered boundary of the study region, which is crucial for subsequent operations.
2. **Road Segment Categorization:** The enriched OSM road network is further processed to differentiate between `nonbridge_spans` and `bridge_spans`. This distinction is vital for the nuanced, two-pass pairing strategy employed later.
3. **TRANSCOM Event Data Loading and Clipping:** Event data from TRANSCOM, provided in a GeoPackage format, is loaded. These events are then spatially filtered (clipped) to include only those falling within the buffered study region derived from the OSM data.
4. **Dynamic LAEA Projection:** To ensure accurate distance calculations and spatial operations, a local LAEA projection is dynamically calculated. The centroid of the buffered study region serves as the center for this equal-area projection.
5. **CRS Transformation:** All relevant spatial datasets—non-bridge spans, bridge spans, and the clipped TRANSCOM events—are reprojected to this common, dynamically generated LAEA CRS. This step standardizes the coordinate system and ensures that distance-based analyses are performed in metric units.

**3.2 Two-Pass Spatial Pairing of Events to Road Spans**

A key innovation in this methodology is a two-pass approach for spatially joining TRANSCOM events to road segments. This strategy is predicated on the observation that flooding often initially impacts underpasses and at-grade roadways (non-bridge spans) before affecting elevated structures like bridges, where events might signify different phenomena (e.g., water pooling, access issues due to nearby washout repairs).

1. **First Pass (Non-Bridge Spans):** All relevant TRANSCOM events are first compared against `nonbridge_spans`. An event is paired with a non-bridge span if it falls within a predefined maximum distance (`max_distance_m`) using a spatial join with a `dwithin` predicate. This captures primary impacts on at-grade infrastructure.
2. **Second Pass (Bridge Spans):** TRANSCOM events that were _not_ successfully paired in the first pass (i.e., were not within the specified distance of any non-bridge span) are then compared against `bridge_spans`, again using the same `dwithin` predicate and `max_distance_m`. This step identifies events specifically affecting or proximal to bridge structures.

The core pairing logic, executed for each pass (and encapsulated in the `pairing_logic.join_road_spans_and_transcom_events` Python function), involves:

- Identifying all road segment-event pairs satisfying the `dwithin` condition.
- For each identified pair, calculating the precise Euclidean distance (in the LAEA CRS) between the event point and the road line segment.
- Generating the `shapely.LineString` geometry representing the shortest line connecting the event point to its paired road segment. For robustness in representing these connecting lines, especially for visualization, they are generated using geometries reprojected to EPSG:4326 (WGS 84) and then transformed to the final output CRS.
- The output of each pairing pass is a GeoDataFrame where each row uniquely represents a road span-event pair. This GeoDataFrame is indexed by a compound key comprising the original road span MultiIndex levels (`u`, `v`, `key`, `span_idx`) and the `transcom_event_id`.

**3.3 Consolidation and Categorization of Pairings**

The results from the two pairing passes (non-bridge and bridge) are then consolidated:

1. The two GeoDataFrames of pairings are concatenated into a single, unified GeoDataFrame (`union_join_gdf`).
2. A `_road_span_type_` attribute (with values 'NONBRIDGE_SPAN' or 'BRIDGE_SPAN') is added to this unified dataset, allowing for easy differentiation of pairings based on the type of road segment involved.

**3.4 Temporal Aggregation of Event Impacts using DuckDB (Gaps-and-Islands)**

To quantify the cumulative impact of events on each road segment, especially when multiple events might overlap in time, a "gaps-and-islands" algorithm is employed using DuckDB. This approach accurately calculates the total duration of impact by merging overlapping time intervals.

1. **Data Preparation for Aggregation:** The `union_join_gdf` (containing all unique road-event pairs) and the original `transcom_events_laea_gdf` (containing event details like start/end times and types) are loaded into DuckDB.
2. **Event Interval Calculation:** A temporary `collected` table is created within DuckDB. This table joins the road-event pairs with their detailed event attributes. Crucially, it calculates the `start_date_time` and `end_date_time` for each event instance (deriving `end_date_time` from `start_date_time` and `event_interval` or `estimated_duration_mins`). Boolean flags are also derived for different event impact categories based on TRANSCOM event properties (e.g., `event_closed_road` from `lanes_detail` and `lanes_status`; `road_flooded` from `nysdot_sub_category` being 'WEATHER HAZARD'; and `road_repairs` from `nysdot_sub_category` indicating 'CONSTRUCTION' or 'MAINTENANCE', particularly noting those repairs potentially related to washouts).
3. **Gaps-and-Islands SQL Logic:** A sophisticated SQL template utilizing Common Table Expressions (CTEs) and window functions (`MAX OVER`, `LAG OVER`, `SUM OVER`) implements the gaps-and-islands algorithm. This logic:
   - Identifies distinct event time intervals for each road segment (`u,v,key`) within specific event categories (all relevant events, road closed, road flooded, road repairs).
   - Orders these intervals by start time.
   - Merges any overlapping or adjacent time intervals to form continuous "islands" of impact for each category.
   - Calculates the duration of each such merged island.
4. **Categorical Aggregation:** The SQL template is executed multiple times, each time substituting a different `WHERE` clause to filter for events belonging to a specific category. This generates separate intermediate tables in DuckDB for each category's aggregated impacts.
5. **Final Aggregated Output:** A final SQL query joins these category-specific aggregated tables by the road segment identifier (`u,v,key`). The result, fetched into a Pandas DataFrame, provides for each road segment:
   - The total merged duration (in hours) of impact for each category.
   - A sorted list of unique `transcom_event_id`s that contributed to the duration within each category.
   - A count of the distinct merged time periods (referred to as "incidents" or "islands") for each category.

**3.5 Final Output Generation and Data Storage**

The culminating step involves integrating the temporally aggregated event impact data with the road network's spatial data:

1. The non-spatial Pandas DataFrame containing the aggregated event metrics (output from DuckDB) is merged with the original OSM road segment geometries (`roads_gdf`). The join is performed using the common road segment identifiers (`u,v,key`).
2. This final, enriched GeoDataFrame, containing both the road segment geometries and the detailed event impact aggregations, is then saved as a layer (e.g., `aggregated_transcom_flood_events_data`) in a GeoPackage file. The default Coordinate Reference System for this output layer is EPSG:4326 (WGS 84), ensuring broad compatibility.

The entire workflow is orchestrated using Prefect, facilitating robust execution, dependency management, and logging of each processing stage.

---

**4. Data Dictionary (New Section or Replacing Existing Section 4)**

The primary output of this analytical workflow is the `aggregated_transcom_flood_events_data` layer, which synthesizes the impact of various event categories on OSM road segments. Each record in this layer represents a unique road segment, identified by its OSMnx-derived `u`, `v`, and `key` attributes. The geometry for each record is the original LineString of the corresponding road segment. Attribute columns detail the aggregated temporal impacts and contributing TRANSCOM event IDs for different event classifications, with all overlapping event time intervals correctly merged.

**Layer: `aggregated_transcom_flood_events_data`**

- **Geometry Type:** LineString
- **Feature Count:** 487 (Note: This count is from the provided example `ogrinfo` output and will vary based on the input data and region.)
- **Extent:** (-74.441750, 42.358757) - (-73.527573, 42.948509) (Note: Example from `ogrinfo`)
- **Coordinate Reference System (CRS):** GEOGCRS["WGS 84", ..., ID["EPSG",4326]] (WGS 84)
  - _(The full WKT from your `ogrinfo` output can be included here if desired for formal publication, or simply stating "EPSG:4326" might suffice depending on journal requirements.)_
- **FID Column:** `fid` (Typically auto-generated by GeoPackage driver)
- **Geometry Column:** `geom`

**Columns:**

| Column Name                                   | Data Type     | Description                                                                                                                                                                                   |
| :-------------------------------------------- | :------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `u`                                           | Integer64     | Starting node identifier of the OSM road segment.                                                                                                                                             |
| `v`                                           | Integer64     | Ending node identifier of the OSM road segment.                                                                                                                                               |
| `key`                                         | Integer64     | Key differentiating multiple edges that may exist between the same `u` and `v` nodes (typically 0 for simple edges).                                                                          |
| `geom`                                        | LineString    | The original geometry of the OSM road segment in the output CRS (EPSG:4326).                                                                                                                  |
| `all_events_ids`                              | String (List) | A sorted list of unique TRANSCOM event IDs for all pre-filtered events (relevant to flooding, road closures, or repairs) that affected this road segment.                                     |
| `all_incidents_count`                         | Integer64     | The count of distinct, continuous time periods (merged intervals or "incidents") during which this road segment was affected by any of the pre-filtered relevant events.                      |
| `all_incidents_total_duration_hours`          | Real          | The total duration in hours that this road segment was affected by any pre-filtered relevant event, after merging all overlapping event times.                                                |
| `road_closed_events_ids`                      | String (List) | A sorted list of unique TRANSCOM event IDs associated with "road closed" conditions (where `event_closed_road` flag was true) affecting this road segment.                                    |
| `road_closed_incidents_count`                 | Integer64     | The count of distinct, continuous time periods during which "road closed" conditions affected this road segment.                                                                              |
| `road_closed_total_duration_hours`            | Real          | The total duration in hours this road segment was affected by "road closed" conditions, after merging all overlapping event times for this category.                                          |
| `road_flooded_events_ids`                     | String (List) | A sorted list of unique TRANSCOM event IDs specifically classified as "road_flooded" (where `road_flooded` flag was true, typically from 'WEATHER HAZARD') affecting this segment.            |
| `road_flooded_incidents_count`                | Integer64     | The count of distinct, continuous time periods during which "road_flooded" conditions affected this road segment.                                                                             |
| `road_flooded_incidents_total_duration_hours` | Real          | The total duration in hours this road segment was affected by "road_flooded" conditions, after merging all overlapping event times for this category.                                         |
| `road_repairs_events_ids`                     | String (List) | A sorted list of unique TRANSCOM event IDs related to "road_repairs" (where `road_repairs` flag was true, from construction/maintenance, potentially washout-related) affecting this segment. |
| `road_repairs_incidents_count`                | Integer64     | The count of distinct, continuous time periods during which "road_repairs" conditions affected this road segment.                                                                             |
| `road_repairs_incidents_total_duration_hours` | Real          | The total duration in hours this road segment was affected by "road_repairs" conditions, after merging all overlapping event times for this category.                                         |
